<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$EPOCH1970 Presale - Verified Since 1970</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:20px; text-align:center; }
    .card { background:#1a1a1a; padding:30px; border-radius:16px; max-width:500px; margin:40px auto; box-shadow:0 10px 30px rgba(0,0,0,0.5); }
    h1 { color:#00ff9d; }
    button { background:#00ff9d; color:#000; font-weight:bold; border:none; padding:14px 30px; margin:10px; border-radius:50px; cursor:pointer; font-size:18px; }
    button:disabled { background:#555; cursor:not-allowed; }
    input { padding:12px; width:80%; max-width:300px; margin:15px; border-radius:8px; border:none; font-size:16px; }
    #status { margin-top:20px; font-size:18px; }
    #error { color:#ff6b6b; }
  </style>
</head>
<body>
  <div class="card">
    <h1>$EPOCH1970 PRESALE</h1>
    <p>Verified since January 1970 — the original OG memecoin</p>
    <p><strong>1 SOL = 1,000,000 $EPOCH1970</strong> (tokens airdropped after presale)</p>

    <button id="connectButton">Connect Phantom Wallet</button>

    <div id="walletInfo" style="display:none; margin-top:20px;">
      <p>Connected: <span id="walletAddress"></span></p>
      <input type="number" id="amount" placeholder="SOL amount" min="0.01" step="0.01" />
      <button id="buyButton">Buy $EPOCH1970</button>
    </div>

    <div id="status"></div>
    <div id="error"></div>
  </div>

  <!-- Solana Web3.js -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js"></script>

  <script>
    // ==== CONFIG — ONLY CHANGE THESE TWO LINES ====
    const PRESALE_WALLET = "7HiYCrQXASerrznzkkwRD5JCz2838vLGTdKaQfmUvFtH"; // Your real presale wallet
    // FIXED: Using public RPC that works in browser (no 403 error)
    const RPC_URL = "https://solana-api.projectserum.com";   // THIS FIXES THE BLOCKHASH 403 ERROR
    // =============================================

    const connection = new solanaWeb3.Connection(RPC_URL);
    let wallet = null;

    document.getElementById("connectButton").onclick = async () => {
      if (!window.solana || !window.solana.isPhantom) {
        alert("Phantom not detected! Open this page inside Phantom app → Explore");
        return;
      }
      try {
        await window.solana.connect();
        wallet = window.solana;
        const addr = wallet.publicKey.toString();
        document.getElementById("walletAddress").textContent = addr.slice(0,4)+"…"+addr.slice(-4);
        document.getElementById("walletInfo").style.display = "block";
        document.getElementById("connectButton").textContent = "Connected";
        document.getElementById("connectButton").disabled = true;
        document.getElementById("status").textContent = "Wallet connected! Ready to buy.";
        document.getElementById("error").textContent = "";
      } catch (e) {
        document.getElementById("error").textContent = "Connection rejected or failed";
      }
    };

    document.getElementById("buyButton").onclick = async () => {
      if (!wallet) return alert("Connect wallet first");

      const solAmount = parseFloat(document.getElementById("amount").value);
      if (!solAmount || solAmount < 0.01) return alert("Enter at least 0.01 SOL");

      document.getElementById("buyButton").disabled = true;
      document.getElementById("status").textContent = "Preparing transaction...";

      try {
        const { blockhash } = await connection.getLatestBlockhash();

        const transferIx = solanaWeb3.SystemProgram.transfer({
          fromPubkey: wallet.publicKey,
          toPubkey: new solanaWeb3.PublicKey(PRESALE_WALLET),
          lamports: Math.round(solAmount * solanaWeb3.LAMPORTS_PER_SOL),
        });

        const tx = new solanaWeb3.Transaction();
        tx.recentBlockhash = blockhash;
        tx.feePayer = wallet.publicKey;
        tx.add(transferIx);

        const { signature } = await wallet.signAndSendTransaction(tx);

        await connection.confirmTransaction(signature, "confirmed");

        document.getElementById("status").innerHTML = `
          SUCCESS!<br>
          \( {solAmount} SOL sent → \){solAmount * 1000000} $EPOCH1970 coming soon!<br>
          <a href="https://solscan.io/tx/${signature}" target="_blank" style="color:#00ff9d; text-decoration:underline;">
            View on Solscan
          </a>
        `;
        document.getElementById("error").textContent = "";
      } catch (err) {
        console.error(err);
        const msg = err.message || "Unknown error";
        document.getElementById("error").textContent = 
          msg.includes("User rejected") ? "You cancelled the transaction" :
          "Transaction failed: " + msg;
      } finally {
        document.getElementById("buyButton").disabled = false;
      }
    };
  </script>
</body>
</html>